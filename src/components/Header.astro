---
import { languages } from '../i18n/locales';
import { useTranslations } from '../i18n/utils';

interface Props {
  lang: string;
}

const { lang } = Astro.props;
const t = useTranslations(lang);

const currentPath = Astro.url.pathname;
const currentLang = lang;
---

<header class="header">
  <div class="container">
    <div class="header-inner">
      <a href={`/${currentLang}`} class="logo">
        GPU<span>Flow</span>
      </a>
      
      <nav class="nav">
        <a href={`/${currentLang}`} class="nav-link">
          {t('nav.home')}
        </a>
        <a href={`/${currentLang}/blog`} class="nav-link">
          {t('nav.blog')}
        </a>
      </nav>

      <div class="lang-wrapper">
        <select 
          class="lang-select" 
          id="lang-select"
          aria-label="Select language"
        >
          {Object.entries(languages).map(([code, name]) => (
            <option value={code} selected={code === currentLang}>
              {name}
            </option>
          ))}
        </select>
      </div>
    </div>
  </div>
</header>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const langSelect = document.getElementById('lang-select') as HTMLSelectElement;
    
    if (langSelect) {
      langSelect.addEventListener('change', (e) => {
        const target = e.target as HTMLSelectElement;
        const newLang = target.value;
        const currentPath = window.location.pathname;
        
        const pathParts = currentPath.split('/').filter(Boolean);
        
        if (pathParts.length > 0) {
          pathParts[0] = newLang;
          window.location.href = '/' + pathParts.join('/');
        } else {
          window.location.href = '/' + newLang;
        }
      });
    }
  });
</script>
